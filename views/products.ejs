<!-- index.ejs -->
<html>
  <head>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/global.css">
    <link rel="stylesheet" href="/products.css">
    <link rel="stylesheet" href="/form.css">
    <title>Products</title>
  </head>
  <body>
    <%- include("partials/header.ejs") %>
    <div class="container">
        <div class="heading">
            <h2>Products</h2>
            <div class="addProduct button"><a href="/products/new">Add a Product</a></div>
        </div>
        <div class="main">
            <div class="sidebar">
                <form action="/products" method="get">

                    <fieldset>
                        <legend>Sort By Price</legend>
                        <label>
                            <input type="radio" name="price_sort" value="asc">
                            Ascending
                        </label>
                        <label>
                            <input type="radio" name="price_sort" value="desc">
                            Descending
                        </label>
                    </fieldset>

                    <fieldset>
                        <legend>Sort By Name</legend>
                        <label>
                            <input type="radio" name="name_sort" value="asc">
                            Ascending
                        </label>
                        <label>
                            <input type="radio" name="name_sort" value="desc">
                            Descending
                        </label>
                    </fieldset>

                    <fieldset>
                        <legend>Filter By Category</legend>
                        <% for (const category of categories) { %>
                        <label>
                            <input type="checkbox" name="category[]" value="<%= category.name %>">
                            <%= category.name %>
                        </label>
                        <% } %>
                    </fieldset>
                    <button class="button" type="submit">Apply</button>

                </form>
            </div>
            <div class="products">
                <% for (const product of products) { %>
                <a href="/products/<%= product.product_id%>">
                    <div class="card">
                        <div class="emoji"><%= product.emoji%></div>
                        <div class="itemContainer">
                            <h3 class="name"><%= product.product_name%></h3>
                            <p class="price">$<%= product.price%></p>
                        </div>
                        <p class="brand">Brand: <%= product.brand%></p>
                        <p class="quantity">Quantity: <%= product.quantity%></p>
                        <div class="category" data-color="<%= product.color %>"
                            style="background-color: <%= product.color %>;"
                            >
                            <%= product.category_name %>
                        </div>
                    </div>
                </a>
                <% } %>
            </div>

        </div>
    </div>
    <%- include("partials/footer.ejs") %>

    <script>
        document.querySelectorAll('.category').forEach(el => {
            const bg = el.dataset.color;

            if (!bg) return;

            const hex = bg.replace('#', '');
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);

            // Relative luminance
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b);

            el.style.color = luminance < 140 ? '#ffffff' : '#333333';
        });
    </script>
  </body>
</html>
